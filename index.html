<script>
const apiKey = "H5n5G0aycS3F4LgAVVzOkJD31AYPcvHR";
const appId = "5f4b72b5-c07b-4c44-aacc-ac136b301d34";
const stationId = "Wellington"; // use valid station code
const url = `https://api.niwa.co.nz/tides/v1/stations/${stationId}/forecasts?appid=${appId}`;

async function fetchTideData() {
  try {
    const response = await fetch(url, {
      headers: { "Authorization": `Bearer ${apiKey}` }
    });
    const data = await response.json();
    return data.forecasts; // make sure 'forecasts' exists
  } catch (err) {
    console.error("Failed to fetch tide data:", err);
    alert("Failed to load tide data. Check console.");
    return [];
  }
}

// rest of your processData() and drawChart() functions remain the same

async function init() {
  const forecasts = await fetchTideData();
  if (forecasts.length === 0) return; // stop if no data
  const { labels, heights, currentIndex } = processData(forecasts);
  drawChart(labels, heights, currentIndex);
}

init();
</script>
