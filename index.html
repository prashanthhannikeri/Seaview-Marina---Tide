<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Seaview Marina Tide Forecast</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: sans-serif; background: #f0f8ff; margin: 20px; }
  h1 { text-align: center; color: #004080; }
  #chartContainer { width: 90%; max-width: 900px; margin: 30px auto; }
</style>
</head>
<body>

<h1>Seaview Marina Tide Forecast</h1>
<div id="chartContainer">
  <canvas id="tideChart"></canvas>
</div>

<script>
// 24-hour hourly sample data
const forecasts = [
  {"time":"2025-11-18T00:00:00","height":1.2},
  {"time":"2025-11-18T01:00:00","height":1.4},
  {"time":"2025-11-18T02:00:00","height":1.6},
  {"time":"2025-11-18T03:00:00","height":1.8},
  {"time":"2025-11-18T04:00:00","height":1.7},
  {"time":"2025-11-18T05:00:00","height":1.5},
  {"time":"2025-11-18T06:00:00","height":1.3},
  {"time":"2025-11-18T07:00:00","height":1.2},
  {"time":"2025-11-18T08:00:00","height":1.4},
  {"time":"2025-11-18T09:00:00","height":1.6},
  {"time":"2025-11-18T10:00:00","height":1.9},
  {"time":"2025-11-18T11:00:00","height":2.1},
  {"time":"2025-11-18T12:00:00","height":2.0},
  {"time":"2025-11-18T13:00:00","height":1.8},
  {"time":"2025-11-18T14:00:00","height":1.6},
  {"time":"2025-11-18T15:00:00","height":1.5},
  {"time":"2025-11-18T16:00:00","height":1.4},
  {"time":"2025-11-18T17:00:00","height":1.3},
  {"time":"2025-11-18T18:00:00","height":1.2},
  {"time":"2025-11-18T19:00:00","height":1.3},
  {"time":"2025-11-18T20:00:00","height":1.5},
  {"time":"2025-11-18T21:00:00","height":1.7},
  {"time":"2025-11-18T22:00:00","height":1.6},
  {"time":"2025-11-18T23:00:00","height":1.4}
];

// Convert data
const dataTimes = forecasts.map(f => new Date(f.time).getTime());
const dataHeights = forecasts.map(f => f.height);
const labels = forecasts.map(f => new Date(f.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hour12:false}));

// Detect high and low tide points
const highTideIndexes = [];
const lowTideIndexes = [];
for(let i=1;i<dataHeights.length-1;i++){
  if(dataHeights[i] > dataHeights[i-1] && dataHeights[i] > dataHeights[i+1]) highTideIndexes.push(i);
  if(dataHeights[i] < dataHeights[i-1] && dataHeights[i] < dataHeights[i+1]) lowTideIndexes.push(i);
}

// Interpolation
function interpHeight(time){
  if(time <= dataTimes[0]) return dataHeights[0];
  if(time >= dataTimes[dataTimes.length-1]) return dataHeights[dataHeights.length-1];
  let i = 0;
  while(time > dataTimes[i+1]) i++;
  const t0 = dataTimes[i], t1 = dataTimes[i+1];
  const h0 = dataHeights[i], h1 = dataHeights[i+1];
  const f = (time - t0)/(t1 - t0);
  return h0 + f*(h1 - h0);
}

// Rising/Falling
function risingFalling(time){
  const nextMin = 60000;
  const hNow = interpHeight(time);
  const hNext = interpHeight(time+nextMin);
  if(hNext > hNow) return "Rising";
  if(hNext < hNow) return "Falling";
  return "Steady";
}

const ctx = document.getElementById('tideChart').getContext('2d');

const tideChart = new Chart(ctx,{
  type:'line',
  data:{
    labels: labels,
    datasets:[
      {
        label:'Tide Height (m)',
        data:dataHeights,
        borderColor:'#007bff',
        backgroundColor:'rgba(0,123,255,0.2)',
        fill:true,
        tension:0.3,
        pointRadius:function(ctx){
          if(highTideIndexes.includes(ctx.dataIndex)) return 7;
          if(lowTideIndexes.includes(ctx.dataIndex)) return 7;
          return 3;
        },
        pointBackgroundColor:function(ctx){
          if(highTideIndexes.includes(ctx.dataIndex)) return 'orange';
          if(lowTideIndexes.includes(ctx.dataIndex)) return 'blue';
          return '#007bff';
        }
      }
    ]
  },
  options:{
    responsive:true,
    animation:false,
    plugins:{tooltip:{enabled:false}, legend:{display:false}},
    scales:{
      x:{title:{display:true,text:'Time'}},
      y:{
        title:{display:true,text:'Height (m)'},
        suggestedMin: Math.min(...dataHeights)-0.5,
        suggestedMax: Math.max(...dataHeights)+0.5
      }
    }
  }
});

let dragging=false;
let currentTime = new Date().getTime();

function drawRedLine(time){
  tideChart.update();
  const ctx2 = tideChart.ctx;
  const xPixel = tideChart.scales.x.getPixelForValue(
    tideChart.scales.x.getValueForPixel(0) + (time-dataTimes[0])/(dataTimes[dataTimes.length-1]-dataTimes[0])*(tideChart.scales.x.right-tideChart.scales.x.left)
  );
  const h = interpHeight(time);
  const rf = risingFalling(time);

  // Red line
  ctx2.save();
  ctx2.beginPath();
  ctx2.moveTo(xPixel,tideChart.scales.y.top);
  ctx2.lineTo(xPixel,tideChart.scales.y.bottom);
  ctx2.strokeStyle='red';
  ctx2.lineWidth=2;
  ctx2.stroke();

  // Tooltip
  const text = h.toFixed(2)+" m ("+rf+")";
  ctx2.fillStyle='white';
  ctx2.strokeStyle='black';
  ctx2.lineWidth=1;
  ctx2.beginPath();
  ctx2.rect(xPixel+10,tideChart.scales.y.getPixelForValue(h)-20,ctx2.measureText(text).width+12,20);
  ctx2.fill();
  ctx2.stroke();
  ctx2.fillStyle='black';
  ctx2.fillText(text,xPixel+16,tideChart.scales.y.getPixelForValue(h)-6);
  ctx2.restore();
}

// Initial draw
drawRedLine(currentTime);

// Dragging
tideChart.canvas.addEventListener('mousedown',()=>{dragging=true;});
tideChart.canvas.addEventListener('mouseup',()=>{
  dragging=false;
  currentTime=new Date().getTime();
  drawRedLine(currentTime);
});
tideChart.canvas.addEventListener('mousemove',(e)=>{
  if(!dragging) return;
  const rect = tideChart.canvas.getBoundingClientRect();
  const x = e.clientX-rect.left;
  const value = tideChart.scales.x.getValueForPixel(x);
  const time = dataTimes[0]+value/(tideChart.scales.x.right-tideChart.scales.x.left)*(dataTimes[dataTimes.length-1]-dataTimes[0]);
  drawRedLine(time);
});

// Update red line every minute
setInterval(()=>{
  if(!dragging){
    currentTime=new Date().getTime();
    drawRedLine(currentTime);
  }
},60000);
